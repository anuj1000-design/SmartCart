<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>SmartCart425 Admin-login</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icons/favicon.png">
    <link rel="shortcut icon" href="icons/favicon.png" type="image/png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com/"></script>
    
    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ["Inter", "sans-serif"],
                        mono: ["JetBrains Mono", "monospace"]
                    },
                    colors: {
                        slate: {
                            850: '#151e2e',
                            900: '#0f172a',
                            950: '#020617',
                        },
                        primary: {
                            400: "#34d399", // Emerald 400
                            500: "#10b981", // Emerald 500
                            600: "#059669", // Emerald 600
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(16, 185, 129, 0.15)',
                        'glow-hover': '0 0 30px rgba(16, 185, 129, 0.3)',
                    },
                    animation: {
                        'shimmer': 'shimmer 2.5s infinite',
                        'fade': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Custom scrollbar for menu */
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #64748b; }

        body {
            background-color: #020617; /* Slate 950 */
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(16, 185, 129, 0.08), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(59, 130, 246, 0.08), transparent 25%);
            min-height: 100vh;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-header {
            background: rgba(2, 6, 23, 0.8);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Spotlight Card Effect (Premium Hover) */
        .spotlight-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(12px);
            transition: transform 0.3s ease, background 0.3s ease;
        }
        
        .spotlight-card::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: inherit;
            padding: 1px;
            background: radial-gradient(
                800px circle at var(--mouse-x) var(--mouse-y),
                rgba(52, 211, 153, 0.4),
                transparent 40%
            );
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .spotlight-card:hover::before { opacity: 1; }
        .spotlight-card:hover { transform: translateY(-3px); background: rgba(30, 41, 59, 0.6); }

        /* Icon Hover Scale */
        .hover-scale-icon { transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .group:hover .hover-scale-icon { transform: scale(1.2) rotate(5deg); }

        /* Button Shimmer Effect */
        .btn-shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shimmer 3s infinite;
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        /* Animations */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        /* Changed to 'both' to handle start/end states correctly */
        .animate-enter { animation: fadeInScale 0.4s cubic-bezier(0.16, 1, 0.3, 1) both; }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Changed to 'both' to fix visibility issues */
        .animate-slide-up { animation: slideInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) both; }

        /* Table row stagger animation */
        tbody tr {
            animation: slideInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) both;
        }
        tbody tr:nth-child(1) { animation-delay: 0.05s; }
        tbody tr:nth-child(2) { animation-delay: 0.1s; }
        tbody tr:nth-child(3) { animation-delay: 0.15s; }
        tbody tr:nth-child(4) { animation-delay: 0.2s; }
        tbody tr:nth-child(5) { animation-delay: 0.25s; }
        
        /* Stagger glass panels */
        /* IMPORTANT: Removed opacity:0 and changed to 'both' to fix blank loading issue */
        .glass-panel, .spotlight-card {
            animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) both;
        }
        .spotlight-card:nth-child(1) { animation-delay: 0.1s; }
        .spotlight-card:nth-child(2) { animation-delay: 0.2s; }
        .spotlight-card:nth-child(3) { animation-delay: 0.3s; }
        .spotlight-card:nth-child(4) { animation-delay: 0.4s; }

        /* Loader */
        .loader {
            border: 2px solid rgba(255,255,255,0.1);
            border-left-color: #34d399;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Styles for fixed tab behavior */
        .active-menu {
            background: rgba(16, 185, 129, 0.2) !important;
            color: white !important;
        }
    </style>
</head>
<body class="text-slate-300 antialiased selection:bg-primary-500/30 selection:text-primary-400" onmousemove="updateMouse(event)">

    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <!-- Background decorative elements -->
        <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none"></div>
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-primary-500/20 rounded-full blur-[100px] pointer-events-none"></div>

        <div class="glass-panel relative rounded-2xl p-10 max-w-md w-full text-center shadow-2xl border border-white/10 animate-enter">
            <div class="w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-8 ring-1 ring-white/10 shadow-glow bg-slate-900/50">
                <img src="icons/favicon.png" alt="SmartCart Logo" class="w-16 h-16 object-contain drop-shadow-lg" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3759/3759041.png'">
            </div>
            <h1 class="text-4xl font-bold mb-3 text-white tracking-tight">SmartCart<span class="text-primary-400">425</span></h1>
            <p class="text-slate-400 mb-10 text-lg">Admin Command Center</p>
            
            <button onclick="signIn()" class="group w-full relative overflow-hidden bg-white text-slate-900 font-bold py-4 px-6 rounded-xl hover:bg-slate-200 transition-all duration-300 flex items-center justify-center gap-3 shadow-lg hover:shadow-xl hover:scale-[1.02]">
                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-6 h-6" alt="Google">
                <span>Sign in with Google</span>
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="hidden min-h-screen flex flex-col">
        
        <!-- Header -->
        <header class="glass-header sticky top-0 z-40 transition-all duration-300">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-20">
                    <!-- Logo -->
                    <div class="flex items-center gap-4 group cursor-default">
                        <img src="icons/favicon.png" alt="Logo" class="w-10 h-10 rounded-lg shadow-lg object-contain bg-slate-900/50" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3759/3759041.png'">
                        <div>
                            <h1 class="text-lg font-bold text-white tracking-tight group-hover:text-primary-400 transition-colors">SmartCart<span class="text-primary-400">425</span></h1>
                            <div class="flex items-center gap-2">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                                <p class="text-[10px] text-slate-400 font-mono uppercase tracking-wider">Live System</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Global Search -->
                    <div class="flex-1 max-w-md mx-8 hidden md:block">
                        <div class="relative group">
                            <input type="text" id="global-search" onkeyup="globalSearch(this.value)" placeholder="Search products, orders, users..." class="w-full pl-10 pr-4 py-2.5 bg-slate-900/50 border border-white/10 rounded-xl text-white placeholder:text-slate-500 focus:outline-none focus:border-primary-500/50 focus:bg-slate-900/80 transition-all shadow-inner"/>
                            <span class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-lg pointer-events-none group-focus-within:text-primary-400 transition-colors">search</span>
                        </div>
                    </div>
                    
                    <!-- Right Actions -->
                    <div class="flex items-center gap-3">
                        <button onclick="toggleTheme()" class="p-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors hidden">
                            <span class="material-symbols-rounded" id="theme-icon">light_mode</span>
                        </button>
                    </div>
                </div>
                
                <!-- Hamburger Menu Button & Nav Bar -->
                <div class="flex items-center gap-4 pb-4 md:pb-0">
                    <button onclick="toggleMenu()" id="menu-btn" class="relative p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-all duration-300 group">
                        <span class="material-symbols-rounded text-xl">menu</span>
                    </button>
                    
                    <!-- Current Tab Indicator -->
                    <div class="hidden md:flex items-center gap-2 px-3 py-1.5 bg-slate-800/50 rounded-lg border border-white/10">
                        <span class="material-symbols-rounded text-sm text-primary-400" id="current-tab-icon">dashboard</span>
                        <span class="text-sm font-medium text-white" id="current-tab-name">Dashboard</span>
                    </div>

                    <!-- Search Result Navigation (Hidden by default) -->
                    <div id="search-nav-btn" style="display:none;" class="ml-4">
                        <button onclick="showTab('search')" class="px-3 py-1.5 bg-blue-600/20 text-blue-400 border border-blue-600/30 rounded-lg text-sm font-medium animate-pulse">
                            View Search Results
                        </button>
                    </div>
                </div>
                
                <!-- Slide-out Navigation Menu MOVED OUTSIDE HEADER -->
            </div>
        </header>

        <!-- Slide-out Navigation Menu (Clean Modern Design) -->
        <div id="slide-menu" class="fixed top-0 left-0 h-full w-80 bg-slate-900 border-r-2 border-slate-700 transform -translate-x-full transition-all duration-300 ease-in-out z-50 shadow-2xl overflow-hidden" style="display: none;">
            <!-- Clean background with subtle gradient -->
            <div class="absolute inset-0 bg-gradient-to-b from-slate-800 to-slate-900 pointer-events-none"></div>
            <div class="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-slate-700 to-slate-800 pointer-events-none"></div>
            
            <div class="flex flex-col h-full relative z-10">
                <!-- Menu Header with clean modern styling -->
                <div class="flex items-center justify-between p-6 border-b-2 border-slate-700 bg-slate-800/95">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-lg border border-primary-400/30">
                            <span class="material-symbols-rounded text-white text-lg">shopping_cart</span>
                        </div>
                        <div>
                            <h3 class="text-white font-bold text-lg tracking-tight">SmartCart</h3>
                            <p class="text-slate-400 text-xs font-medium">Admin Panel</p>
                        </div>
                    </div>
                    <button onclick="toggleMenu()" class="p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-slate-600">
                        <span class="material-symbols-rounded relative z-10 transition-transform duration-300 group-hover:rotate-90">close</span>
                    </button>
                </div>
                
                <!-- Menu Items with clean modern styling -->
                <div class="flex-1 py-6 px-4 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-transparent">
                    <div class="space-y-1">
                        <button onclick="selectMenuItem('dashboard', 'dashboard', 'Dashboard')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-primary-500/20 hover:to-primary-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-primary-500/30 active-menu" data-target="dashboard">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">dashboard</span>
                            <span class="font-medium relative z-10">Dashboard</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-primary-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('notify', 'notifications_active', 'Notify')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500/20 hover:to-blue-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-blue-500/30" data-target="notify">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">notifications_active</span>
                            <span class="font-medium relative z-10">Notify</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('products', 'inventory_2', 'Products')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-emerald-500/20 hover:to-emerald-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-emerald-500/30" data-target="products">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">inventory_2</span>
                            <span class="font-medium relative z-10">Products</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-emerald-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('orders', 'shopping_bag', 'Orders')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-purple-500/20 hover:to-purple-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-purple-500/30" data-target="orders">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">shopping_bag</span>
                            <span class="font-medium relative z-10">Orders</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-purple-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('users', 'people', 'Users')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-cyan-500/20 hover:to-cyan-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-cyan-500/30" data-target="users">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">people</span>
                            <span class="font-medium relative z-10">Users</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-cyan-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('ratings', 'star', 'Ratings')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-yellow-500/20 hover:to-yellow-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-yellow-500/30" data-target="ratings">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">star</span>
                            <span class="font-medium relative z-10">Ratings</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-yellow-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('analytics', 'analytics', 'Analytics')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-indigo-500/20 hover:to-indigo-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-indigo-500/30" data-target="analytics">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">analytics</span>
                            <span class="font-medium relative z-10">Analytics</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('feedbacks', 'feedback', 'Feedbacks')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-pink-500/20 hover:to-pink-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-pink-500/30" data-target="feedbacks">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">feedback</span>
                            <span class="font-medium relative z-10">Feedbacks</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-pink-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('support', 'support_agent', 'Support')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-orange-500/20 hover:to-orange-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-orange-500/30" data-target="support">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">support_agent</span>
                            <span class="font-medium relative z-10">Support</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-orange-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('settings', 'settings', 'Settings')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-gray-500/20 hover:to-gray-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-gray-500/30" data-target="settings">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">settings</span>
                            <span class="font-medium relative z-10">Settings</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-gray-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                        
                        <button onclick="selectMenuItem('bug-reports', 'bug_report', 'Bug Reports')" class="menu-item w-full flex items-center gap-3 px-4 py-3 text-left text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-red-500/20 hover:to-red-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-red-500/30" data-target="bug-reports">
                            <span class="material-symbols-rounded text-lg group-hover:scale-110 transition-transform duration-300 relative z-10">bug_report</span>
                            <span class="font-medium relative z-10">Bug Reports</span>
                            <div class="ml-auto w-2 h-2 rounded-full bg-red-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                        </button>
                    </div>
                </div>
                
                <!-- Menu Footer with clean modern styling -->
                <div class="p-6 border-t-2 border-slate-700 bg-slate-800/95">
                    <button onclick="signOut()" class="w-full flex items-center gap-3 px-4 py-3 text-left text-red-400 hover:text-white hover:bg-gradient-to-r hover:from-red-500/20 hover:to-red-600/10 rounded-lg transition-all duration-300 group relative overflow-hidden border border-transparent hover:border-red-500/30">
                        <span class="material-symbols-rounded text-lg group-hover:rotate-180 transition-transform duration-500 relative z-10">logout</span>
                        <span class="font-medium relative z-10">Sign Out</span>
                        <div class="ml-auto w-2 h-2 rounded-full bg-red-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300 relative z-10"></div>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Menu Overlay MOVED OUTSIDE HEADER -->
        <div id="menu-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 invisible transition-all duration-300 z-40" onclick="toggleMenu()" style="display: none;"></div>

        <!-- Main Content -->
        <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8">

            <!-- Dashboard Tab (Default) -->
            <div id="tab-dashboard" class="tab-content animate-enter">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Dashboard & Sales</h2>
                        <p class="text-slate-400 text-sm mt-1">Revenue analytics and inventory overview</p>
                    </div>
                    <button onclick="loadSalesData()" class="px-6 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-semibold shadow-lg shadow-primary-500/20 transition-all flex items-center gap-2">
                        <span class="material-symbols-rounded text-sm">refresh</span>
                        <span>Refresh</span>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                    <!-- Spotlight Stat Cards -->
                    <div class="spotlight-card p-6 rounded-2xl group cursor-default">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 border border-blue-500/20 group-hover:scale-110 transition-transform duration-300">
                                <span class="material-symbols-rounded text-2xl hover-scale-icon">inventory_2</span>
                            </div>
                            <span class="text-[10px] font-bold tracking-widest text-emerald-400 bg-emerald-500/10 border border-emerald-500/20 px-2 py-1 rounded-full">ACTIVE</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1 tracking-tight" id="stat-total-products">0</h3>
                        <p class="text-slate-400 text-sm font-medium">Total Inventory</p>
                    </div>
                    
                    <div class="spotlight-card p-6 rounded-2xl group cursor-default">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400 border border-orange-500/20 group-hover:scale-110 transition-transform duration-300">
                                <span class="material-symbols-rounded text-2xl hover-scale-icon">warning</span>
                            </div>
                        </div>
                        <h3 class="text-3xl font-bold text-orange-400 mb-1 tracking-tight" id="stat-low-stock">0</h3>
                        <p class="text-slate-400 text-sm font-medium">Low Stock Alerts</p>
                    </div>
                    
                    <div class="spotlight-card p-6 rounded-2xl group cursor-default">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 border border-emerald-500/20 group-hover:scale-110 transition-transform duration-300">
                                <span class="material-symbols-rounded text-2xl hover-scale-icon">shopping_bag</span>
                            </div>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1 tracking-tight" id="stat-total-orders">0</h3>
                        <p class="text-slate-400 text-sm font-medium">Total Orders</p>
                    </div>
                    
                    <div class="spotlight-card p-6 rounded-2xl group cursor-default relative">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                        <div class="flex items-center justify-between mb-4 relative z-10">
                            <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 border border-purple-500/20 group-hover:scale-110 transition-transform duration-300">
                                <span class="material-symbols-rounded text-2xl hover-scale-icon">currency_rupee</span>
                            </div>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1 tracking-tight relative z-10" id="stat-total-revenue">₹0</h3>
                        <p class="text-slate-400 text-sm font-medium relative z-10">Total Revenue</p>
                    </div>
                    
                    <div class="spotlight-card p-6 rounded-2xl group cursor-default">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-cyan-500/10 flex items-center justify-center text-cyan-400 border border-cyan-500/20 group-hover:scale-110 transition-transform duration-300">
                                <span class="material-symbols-rounded text-2xl hover-scale-icon">avg_pace</span>
                            </div>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1 tracking-tight" id="avg-order-value">₹0</h3>
                        <p class="text-slate-400 text-sm font-medium">Avg Order Value</p>
                    </div>
                </div>
                
                <!-- Top Selling Products -->
                <div class="glass-panel rounded-2xl p-6 mb-8">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="material-symbols-rounded text-primary-400">leaderboard</span>
                        Top Selling Products
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="text-xs text-slate-400 uppercase border-b border-white/5">
                                <tr>
                                    <th class="px-6 py-4">Product</th>
                                    <th class="px-6 py-4">Sales</th>
                                    <th class="px-6 py-4">Revenue</th>
                                    <th class="px-6 py-4">Stock</th>
                                </tr>
                            </thead>
                            <tbody id="top-products-tbody" class="divide-y divide-white/5 text-sm">
                                <tr><td colspan="4" class="px-6 py-8 text-center text-slate-500">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Low Stock Alerts -->
                <div class="glass-panel rounded-2xl p-6 md:p-8">
                    <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
                        <span class="flex h-3 w-3 relative">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-orange-500"></span>
                        </span>
                        Low Stock Attention
                    </h2>
                    <div id="low-stock-list" class="space-y-3">
                        <p class="text-slate-500 italic text-sm py-4">All systems normal. Stock levels sufficient.</p>
                    </div>
                </div>
            </div>

            <!-- Notify Tab -->
            <div id="tab-notify" class="tab-content hidden animate-enter">
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="glass-panel rounded-2xl p-8 w-full lg:max-w-md">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary-400">notifications_active</span>
                            Send Notification to All Users
                        </h2>
                        <form id="notify-form" onsubmit="sendNotificationToAll(event)">
                            <div class="mb-4">
                                <label class="block text-slate-400 mb-2 font-medium">Title</label>
                                <input type="text" id="notify-title" required class="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Notification title">
                            </div>
                            <div class="mb-6">
                                <label class="block text-slate-400 mb-2 font-medium">Message</label>
                                <textarea id="notify-message" required class="w-full bg-slate-900/50 border border-white/10 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" rows="4" placeholder="Notification message"></textarea>
                            </div>
                            <button type="submit" class="px-6 py-3 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-bold shadow-lg shadow-primary-500/20 transition-all w-full">Send Notification</button>
                        </form>
                        <div id="notify-status" class="mt-4 text-center text-sm"></div>
                    </div>
                    <div class="glass-panel rounded-2xl p-6 w-full">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-rounded text-primary-400">history</span>
                            Notification History
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                    <tr>
                                        <th class="px-4 py-3">Title</th>
                                        <th class="px-4 py-3">Message</th>
                                        <th class="px-4 py-3">Sent At</th>
                                        <th class="px-4 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="notification-history-table" class="divide-y divide-white/5 text-sm">
                                    <tr><td colspan="4" class="px-4 py-8 text-center text-slate-500">Loading history...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="tab-products" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Inventory</h2>
                        <p class="text-slate-400 text-sm mt-1">Manage your product catalog</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <input type="file" id="import-csv-file" accept=".csv" class="hidden" onchange="handleCSVImport(event)">
                        <button onclick="document.getElementById('import-csv-file').click()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">upload</span>
                            Import CSV
                        </button>
                        <button onclick="exportProductsCSV()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">download</span>
                            Export CSV
                        </button>
                        <button onclick="printProducts()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">print</span>
                            Print
                        </button>
                        <button onclick="openAddProductModal()" class="relative px-6 py-2.5 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-bold shadow-lg shadow-primary-500/20 hover:shadow-primary-500/40 transition-all flex items-center justify-center gap-2 group overflow-hidden">
                            <span class="relative z-10 flex items-center gap-2">
                                <span class="material-symbols-rounded group-hover:rotate-90 transition-transform">add</span>
                                Add Product
                            </span>
                            <div class="btn-shimmer"></div>
                        </button>
                    </div>
                </div>
                
                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="p-4 border-b border-white/5 bg-slate-900/50">
                        <div class="relative">
                            <span class="material-symbols-rounded absolute left-4 top-3 text-slate-500">search</span>
                            <input type="text" id="search-products" onkeyup="filterProducts()" placeholder="Search by barcode, name, or category..." 
                                class="w-full pl-12 pr-4 py-2.5 bg-slate-900/50 border border-white/10 rounded-xl text-white placeholder-slate-500 focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">Product</th>
                                    <th class="px-6 py-4">Barcode</th>
                                    <th class="px-6 py-4">Category</th>
                                    <th class="px-6 py-4">Price</th>
                                    <th class="px-6 py-4">Stock</th>
                                    <th class="px-6 py-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="products-table" class="divide-y divide-white/5 text-sm">
                                <tr><td colspan="6" class="px-6 py-12 text-center text-slate-500"><div class="inline-block loader mr-2"></div> Loading data...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="tab-orders" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Orders</h2>
                        <p class="text-slate-400 text-sm mt-1">Real-time transaction history</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button onclick="exportOrdersCSV()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">download</span>
                            CSV
                        </button>
                        <button onclick="printOrders()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">print</span>
                            Print
                        </button>
                    </div>
                </div>
                
                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">Receipt #</th>
                                    <th class="px-6 py-4">Order #</th>
                                    <th class="px-6 py-4">Exit Code</th>
                                    <th class="px-6 py-4">Date & Time</th>
                                    <th class="px-6 py-4">Items</th>
                                    <th class="px-6 py-4">Total Amount</th>
                                    <th class="px-6 py-4">Method</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table" class="divide-y divide-white/5 text-sm">
                                <tr><td colspan="7" class="px-6 py-12 text-center text-slate-500"><div class="inline-block loader mr-2"></div> Fetching orders...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="tab-users" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Users</h2>
                        <p class="text-slate-400 text-sm mt-1">Customer management</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button onclick="exportUsersCSV()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">download</span>
                            CSV
                        </button>
                        <button onclick="printUsers()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">print</span>
                            Print
                        </button>
                    </div>
                </div>
                
                <!-- User Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="spotlight-card p-6 rounded-2xl">
                        <h3 class="text-slate-400 text-sm font-medium mb-2 uppercase tracking-wide">Total Users</h3>
                        <p class="text-3xl font-bold text-white" id="stat-total-users">0</p>
                    </div>
                    <div class="spotlight-card p-6 rounded-2xl">
                        <h3 class="text-slate-400 text-sm font-medium mb-2 uppercase tracking-wide">Active Users</h3>
                        <p class="text-3xl font-bold text-emerald-400" id="stat-active-users">0</p>
                    </div>
                    <div class="spotlight-card p-6 rounded-2xl">
                        <h3 class="text-slate-400 text-sm font-medium mb-2 uppercase tracking-wide">Suspended</h3>
                        <p class="text-3xl font-bold text-red-400" id="stat-suspended-users">0</p>
                    </div>
                </div>
                
                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="p-4 border-b border-white/5 bg-slate-900/50">
                        <div class="relative">
                            <span class="material-symbols-rounded absolute left-4 top-3 text-slate-500">search</span>
                            <input type="text" id="search-users" onkeyup="filterUsers()" placeholder="Search by email or name..." 
                                class="w-full bg-slate-900/50 border border-slate-700 rounded-lg pl-12 pr-4 py-2.5 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">Avatar</th>
                                    <th class="px-6 py-4">Email</th>
                                    <th class="px-6 py-4">Name</th>
                                    <th class="px-6 py-4">Phone</th>
                                    <th class="px-6 py-4">Role</th>
                                    <th class="px-6 py-4">Total Spent</th>
                                    <th class="px-6 py-4">Orders</th>
                                    <th class="px-6 py-4">Last Active</th>
                                    <th class="px-6 py-4">Status</th>
                                    <th class="px-6 py-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table" class="divide-y divide-white/5 text-sm">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ratings Tab -->
            <div id="tab-ratings" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Product Ratings & Reviews</h2>
                        <p class="text-slate-400 text-sm mt-1">User ratings analytics across all products</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button onclick="refreshRatingsData()" class="px-6 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-semibold border border-primary-500/10 shadow-lg shadow-primary-500/20 transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">refresh</span>
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Overall Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="spotlight-card rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-rounded text-orange-400 text-3xl">star</span>
                            <span class="text-xs font-semibold px-2.5 py-1 rounded-full bg-orange-500/20 text-orange-400">OVERALL</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="overall-avg-rating">0.0</h3>
                        <p class="text-slate-400 text-sm">Average Rating</p>
                    </div>
                    
                    <div class="spotlight-card rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-rounded text-blue-400 text-3xl">reviews</span>
                            <span class="text-xs font-semibold px-2.5 py-1 rounded-full bg-blue-500/20 text-blue-400">TOTAL</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="total-reviews">0</h3>
                        <p class="text-slate-400 text-sm">Total Reviews</p>
                    </div>
                    
                    <div class="spotlight-card rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-rounded text-green-400 text-3xl">inventory_2</span>
                            <span class="text-xs font-semibold px-2.5 py-1 rounded-full bg-green-500/20 text-green-400">PRODUCTS</span>
                        </div>
                        <h3  class="text-3xl font-bold text-white mb-1" id="rated-products">0</h3>
                        <p class="text-slate-400 text-sm">Rated Products</p>
                    </div>
                    
                    <div class="spotlight-card rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-rounded text-purple-400 text-3xl">person</span>
                            <span class="text-xs font-semibold px-2.5 py-1 rounded-full bg-purple-500/20 text-purple-400">USERS</span>
                        </div>
                        <h3 class="text-3xl font-bold text-white mb-1" id="active-reviewers">0</h3>
                        <p class="text-slate-400 text-sm">Active Reviewers</p>
                    </div>
                </div>

                <!-- Two Column Layout -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Most Reviewed Products -->
                    <div class="spotlight-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-yellow-400">trending_up</span>
                            Most Reviewed Products
                        </h3>
                        <div id="top-rated-products" class="space-y-4">
                            <div class="flex items-center justify-center py-12 text-slate-500">
                                <span class="material-symbols-rounded text-4xl">hourglass_empty</span>
                                <p class="ml-3">Loading...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Rating Distribution -->
                    <div class="spotlight-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-blue-400">bar_chart</span>
                            Rating Distribution
                        </h3>
                        <div id="rating-distribution" class="space-y-3">
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-slate-400 w-8">5 ★</span>
                                <div class="flex-1 h-8 bg-slate-800 rounded-lg overflow-hidden">
                                    <div id="rating-bar-5" class="h-full bg-gradient-to-r from-yellow-500 to-orange-500 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <span id="rating-count-5" class="text-sm text-slate-300 w-12 text-right">0</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-slate-400 w-8">4 ★</span>
                                <div class="flex-1 h-8 bg-slate-800 rounded-lg overflow-hidden">
                                    <div id="rating-bar-4" class="h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <span id="rating-count-4" class="text-sm text-slate-300 w-12 text-right">0</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-slate-400 w-8">3 ★</span>
                                <div class="flex-1 h-8 bg-slate-800 rounded-lg overflow-hidden">
                                    <div id="rating-bar-3" class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <span id="rating-count-3" class="text-sm text-slate-300 w-12 text-right">0</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-slate-400 w-8">2 ★</span>
                                <div class="flex-1 h-8 bg-slate-800 rounded-lg overflow-hidden">
                                    <div id="rating-bar-2" class="h-full bg-gradient-to-r from-orange-500 to-yellow-600 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <span id="rating-count-2" class="text-sm text-slate-300 w-12 text-right">0</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-slate-400 w-8">1 ★</span>
                                <div class="flex-1 h-8 bg-slate-800 rounded-lg overflow-hidden">
                                    <div id="rating-bar-1" class="h-full bg-gradient-to-r from-red-500 to-pink-500 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <span id="rating-count-1" class="text-sm text-slate-300 w-12 text-right">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Ratings Table -->
                <div class="spotlight-card rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                        <span class="material-symbols-rounded text-purple-400">people</span>
                        User Ratings Activity
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-white/10">
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Reviews Count</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Avg Rating</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Last Review</th>
                                </tr>
                            </thead>
                            <tbody id="user-ratings-tbody" class="divide-y divide-white/5">
                                <tr>
                                    <td colspan="4" class="px-6 py-12 text-center text-slate-500">
                                        <span class="material-symbols-rounded text-4xl mb-2">hourglass_empty</span>
                                        <p>Loading user ratings...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="tab-analytics" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Analytics</h2>
                        <p class="text-slate-400 text-sm mt-1">Performance metrics and insights</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button onclick="loadAnalyticsData()" class="px-6 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-semibold shadow-lg transition-all flex items-center gap-2">
                            <span class="material-symbols-rounded text-sm">refresh</span>
                            Refresh
                        </button>
                        <button onclick="exportAnalyticsCSV()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">download</span>
                            CSV
                        </button>
                        <button onclick="printAnalytics()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">print</span>
                            Print
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- User Activity -->
                    <div class="spotlight-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-purple-400">pie_chart</span>
                            User Activity
                        </h3>
                        <div class="relative" style="height: 300px;">
                            <canvas id="user-activity-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="spotlight-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-yellow-400">trophy</span>
                            Top Performing Products
                        </h3>
                        <div class="relative" style="height: 300px;">
                            <canvas id="top-products-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Stock Status -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="spotlight-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-orange-400">inventory_2</span>
                            Stock Status
                        </h3>
                        <div class="relative" style="height: 300px;">
                            <canvas id="stock-status-chart"></canvas>
                        </div>
                    </div>

                    <div class="spotlight-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-pink-400">category</span>
                            Category Distribution
                        </h3>
                        <div class="relative" style="height: 300px;">
                            <canvas id="category-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedbacks Tab -->
            <div id="tab-feedbacks" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">User Feedbacks</h2>
                        <p class="text-slate-400 text-sm mt-1">Reviews and suggestions</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button onclick="exportFeedbacksCSV()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">download</span>
                            CSV
                        </button>
                        <button onclick="printFeedbacks()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">print</span>
                            Print
                        </button>
                    </div>
                </div>
                
                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">User Email</th>
                                    <th class="px-6 py-4">Rating</th>
                                    <th class="px-6 py-4">Feedback</th>
                                    <th class="px-6 py-4">Category</th>
                                    <th class="px-6 py-4">Date</th>
                                </tr>
                            </thead>
                            <tbody id="feedbacks-table" class="divide-y divide-white/5 text-sm">
                                <tr><td colspan="5" class="px-6 py-12 text-center text-slate-500"><div class="inline-block loader mr-2"></div> Fetching feedbacks...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Bug Reports Tab -->
            <div id="tab-bug-reports" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Bug Reports</h2>
                        <p class="text-slate-400 text-sm mt-1">Issues reported by users</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <button onclick="exportBugReportsCSV()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">download</span>
                            CSV
                        </button>
                        <button onclick="printBugReports()" class="px-6 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-semibold border border-white/10 shadow-lg transition-all flex items-center justify-center gap-2 group">
                            <span class="material-symbols-rounded text-sm">print</span>
                            Print
                        </button>
                    </div>
                </div>
                
                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">User Email</th>
                                    <th class="px-6 py-4">Title</th>
                                    <th class="px-6 py-4">Description</th>
                                    <th class="px-6 py-4">Status</th>
                                    <th class="px-6 py-4">Date</th>
                                </tr>
                            </thead>
                            <tbody id="bug-reports-table" class="divide-y divide-white/5 text-sm">
                                <tr><td colspan="5" class="px-6 py-12 text-center text-slate-500"><div class="inline-block loader mr-2"></div> Fetching bug reports...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Support Tickets Tab -->
            <div id="tab-support" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Support Tickets</h2>
                        <p class="text-slate-400 text-sm mt-1">Manage customer support requests</p>
                    </div>
                </div>

                <!-- Ticket Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="glass-panel rounded-2xl p-4">
                        <div class="flex items-center justify-between">
                            <span class="text-blue-400 material-symbols-rounded">new_releases</span>
                            <span class="text-2xl font-bold text-blue-400" id="open-tickets">0</span>
                        </div>
                        <p class="text-white font-medium mt-2">Open</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-4">
                        <div class="flex items-center justify-between">
                            <span class="text-yellow-400 material-symbols-rounded">pending</span>
                            <span class="text-2xl font-bold text-yellow-400" id="pending-tickets">0</span>
                        </div>
                        <p class="text-white font-medium mt-2">Pending</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-4">
                        <div class="flex items-center justify-between">
                            <span class="text-orange-400 material-symbols-rounded">schedule</span>
                            <span class="text-2xl font-bold text-orange-400" id="inprogress-tickets">0</span>
                        </div>
                        <p class="text-white font-medium mt-2">In Progress</p>
                    </div>
                    <div class="glass-panel rounded-2xl p-4">
                        <div class="flex items-center justify-between">
                            <span class="text-green-400 material-symbols-rounded">check_circle</span>
                            <span class="text-2xl font-bold text-green-400" id="resolved-tickets">0</span>
                        </div>
                        <p class="text-white font-medium mt-2">Resolved</p>
                    </div>
                </div>

                <!-- Tickets Table -->
                <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                <tr>
                                    <th class="px-6 py-4">ID</th>
                                    <th class="px-6 py-4">Customer</th>
                                    <th class="px-6 py-4">Subject</th>
                                    <th class="px-6 py-4">Priority</th>
                                    <th class="px-6 py-4">Status</th>
                                    <th class="px-6 py-4">Created</th>
                                    <th class="px-6 py-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tickets-table" class="divide-y divide-white/5 text-sm">
                                <tr><td colspan="7" class="px-6 py-12 text-center text-slate-500">Loading support tickets...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="tab-settings" class="tab-content hidden animate-enter">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white tracking-tight">Settings</h2>
                    <p class="text-slate-400 text-sm mt-1">Configure app settings, loyalty program, and manage backups</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- App Settings -->
                    <div class="glass-panel rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-blue-400">tune</span>
                            App Settings
                        </h3>
                        <form onsubmit="saveAppSettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Delivery Charge (₹)</label>
                                <input type="number" id="delivery-charge" step="0.01" value="50" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Tax Rate (%)</label>
                                <input type="number" id="tax-rate" step="0.01" value="18" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Minimum Order Value (₹)</label>
                                <input type="number" id="min-order-value" step="0.01" value="100" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Free Delivery Above (₹)</label>
                                <input type="number" id="free-delivery-above" step="0.01" value="500" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <button type="submit" class="w-full px-4 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-semibold transition-colors">
                                Save Settings
                            </button>
                        </form>
                    </div>

                    <!-- Loyalty Program -->
                    <div class="glass-panel rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-yellow-400">loyalty</span>
                            Loyalty Program
                        </h3>
                        <form onsubmit="saveLoyaltySettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Points per ₹100 Spent</label>
                                <input type="number" id="points-per-100" value="10" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Points Value (₹ per point)</label>
                                <input type="number" id="points-value" step="0.01" value="0.25" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Minimum Points to Redeem</label>
                                <input type="number" id="min-points-redeem" value="100" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Signup Bonus Points</label>
                                <input type="number" id="signup-bonus" value="50" required class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white">
                            </div>
                            <button type="submit" class="w-full px-4 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-semibold transition-colors">
                                Save Loyalty Settings
                            </button>
                        </form>
                    </div>

                    <!-- Featured Products -->
                    <div class="glass-panel rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-purple-400">star</span>
                            Featured Products
                        </h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-300 mb-2">Select Products to Feature</label>
                            <select id="featured-product-select" class="w-full px-4 py-2 bg-slate-900/50 border border-white/10 rounded-xl text-white mb-3">
                                <option value="">Loading products...</option>
                            </select>
                            <button onclick="addFeaturedProduct()" class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-semibold transition-colors">
                                Add to Featured
                            </button>
                        </div>
                        <div id="featured-products-list" class="space-y-2 mt-4">
                            <p class="text-slate-500 text-sm">No featured products yet</p>
                        </div>
                    </div>

                    <!-- Backup & Export -->
                    <div class="glass-panel rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-rounded text-green-400">backup</span>
                            Backup & Export
                        </h3>
                        <div class="space-y-3">
                            <button onclick="backupFullDatabase()" class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-semibold transition-colors flex items-center justify-center gap-2">
                                <span class="material-symbols-rounded">download</span>
                                Full Database Backup
                            </button>
                            <button onclick="exportAllProducts()" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors flex items-center justify-center gap-2">
                                <span class="material-symbols-rounded">inventory</span>
                                Export All Products
                            </button>
                            <button onclick="exportAllOrders()" class="w-full px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-semibold transition-colors flex items-center justify-center gap-2">
                                <span class="material-symbols-rounded">receipt_long</span>
                                Export All Orders
                            </button>
                            <button onclick="exportAllUsers()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-semibold transition-colors flex items-center justify-center gap-2">
                                <span class="material-symbols-rounded">people</span>
                                Export All Users
                            </button>
                        </div>
                        <div id="backup-status" class="mt-4 text-sm text-center text-slate-400"></div>
                    </div>
                </div>
            </div>

            <!-- Search Results Tab -->
            <div id="tab-search" class="tab-content hidden animate-enter">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white tracking-tight">Search Results</h2>
                        <p class="text-slate-400 text-sm" id="search-result-count">Enter search query to find items</p>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <!-- Products Results -->
                    <div id="search-products" style="display:none;">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-rounded text-emerald-400">inventory_2</span>
                            Products <span class="text-sm text-slate-500" id="search-products-count">(0)</span>
                        </h3>
                        <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                        <tr>
                                            <th class="px-6 py-4">Name</th>
                                            <th class="px-6 py-4">Barcode</th>
                                            <th class="px-6 py-4">Category</th>
                                            <th class="px-6 py-4">Price</th>
                                            <th class="px-6 py-4">Stock</th>
                                        </tr>
                                    </thead>
                                    <tbody id="search-products-list" class="divide-y divide-white/5"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Orders Results -->
                    <div id="search-orders" style="display:none;">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-rounded text-blue-400">shopping_bag</span>
                            Orders <span class="text-sm text-slate-500" id="search-orders-count">(0)</span>
                        </h3>
                        <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                        <tr>
                                            <th class="px-6 py-4">Receipt ID</th>
                                            <th class="px-6 py-4">Exit Code</th>
                                            <th class="px-6 py-4">Date</th>
                                            <th class="px-6 py-4">Items</th>
                                            <th class="px-6 py-4">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="search-orders-list" class="divide-y divide-white/5"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Users Results -->
                    <div id="search-users" style="display:none;">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-rounded text-purple-400">people</span>
                            Users <span class="text-sm text-slate-500" id="search-users-count">(0)</span>
                        </h3>
                        <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                        <tr>
                                            <th class="px-6 py-4">Email</th>
                                            <th class="px-6 py-4">Name</th>
                                            <th class="px-6 py-4">Role</th>
                                            <th class="px-6 py-4">Spent</th>
                                            <th class="px-6 py-4">Orders</th>
                                        </tr>
                                    </thead>
                                    <tbody id="search-users-list" class="divide-y divide-white/5"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Feedbacks Results -->
                    <div id="search-feedbacks" style="display:none;">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-rounded text-yellow-400">feedback</span>
                            Feedbacks <span class="text-sm text-slate-500" id="search-feedbacks-count">(0)</span>
                        </h3>
                        <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                        <tr>
                                            <th class="px-6 py-4">Email</th>
                                            <th class="px-6 py-4">Rating</th>
                                            <th class="px-6 py-4">Category</th>
                                            <th class="px-6 py-4">Message</th>
                                        </tr>
                                    </thead>
                                    <tbody id="search-feedbacks-list" class="divide-y divide-white/5"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bug Reports Results -->
                    <div id="search-bugs" style="display:none;">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-rounded text-red-400">bug_report</span>
                            Bug Reports <span class="text-sm text-slate-500" id="search-bugs-count">(0)</span>
                        </h3>
                        <div class="glass-panel rounded-2xl overflow-hidden border border-white/5">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-900/80 text-xs uppercase text-slate-400 font-medium tracking-wider">
                                        <tr>
                                            <th class="px-6 py-4">Email</th>
                                            <th class="px-6 py-4">Title</th>
                                            <th class="px-6 py-4">Status</th>
                                            <th class="px-6 py-4">Description</th>
                                        </tr>
                                    </thead>
                                    <tbody id="search-bugs-list" class="divide-y divide-white/5"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- No Results Message -->
                    <div id="search-no-results" class="text-center py-12">
                        <span class="material-symbols-rounded text-6xl text-slate-600 mb-4 block">search_off</span>
                        <p class="text-slate-400 text-lg">No results found. Try a different search.</p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-md bg-black/60 transition-opacity duration-300" onclick="if(event.target.id==='modal') closeModal()">
        <div class="glass-panel bg-slate-900 border border-white/10 rounded-2xl max-w-2xl w-full max-h-[85vh] overflow-y-auto shadow-2xl animate-enter" onclick="event.stopPropagation()">
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 flex flex-col gap-3 pointer-events-none"></div>

    <script>
        // Mouse Tracking for Spotlight Effect
        function updateMouse(e) {
            const cards = document.getElementsByClassName('spotlight-card');
            for(const card of cards) {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                card.style.setProperty('--mouse-x', `${x}px`);
                card.style.setProperty('--mouse-y', `${y}px`);
            }
        }

        // Whitelist - Logic Preserved
        const ALLOWED_EMAILS = ['admin@example.com', 'user@example.com'];
        // Normalize whitelist for case-insensitive checks
        const ALLOWED_EMAILS_LOWER = ALLOWED_EMAILS.map(e => e.toLowerCase());
        
        // Firebase Config
        const firebaseConfig = window.__FIREBASE_CONFIG || {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.firebasestorage.app",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Make db globally accessible for emergency fix functions
        window.db = db;
        window.auth = auth;
        
        let products = [];
        let orders = [];
        let feedbacks = [];
        let bugReports = [];
        let users = [];
        
        // Auth Functions
        function signIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then(result => {
                // Safe check: ensure user and email exist and compare in lowercase
                const userEmail = result?.user?.email?.toLowerCase?.() || null;
                if (userEmail && ALLOWED_EMAILS_LOWER.includes(userEmail)) {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('app-container').classList.remove('hidden');
                    init();
                    showToast('Welcome back, Admin', 'success');
                } else {
                    auth.signOut();
                    showToast('Access Denied. Unauthorized account.', 'error');
                }
            }).catch(err => showToast('Sign-in failed: ' + err.message, 'error'));
        }
        
        function signOut() {
            auth.signOut().then(() => {
                location.reload();
            });
        }
        
        // Init
        function init() {
            loadProducts();
            loadOrders();
            loadUsers();
            loadNotificationHistory();
            // loadCategories(); // Removed duplicate call if not needed immediately
            // loadSuppliers(); // Removed duplicate call if not needed immediately
            loadActivityLogs();
            populateFeaturedProductSelect();
            
            // Explicitly set dashboard active to fix potential blank state
            selectMenuItem('dashboard', 'dashboard', 'Dashboard');
        }
        
        // Data Loading with error handling
        function loadProducts() {
            db.collection('products').orderBy('purchaseCount', 'desc').onSnapshot(
                snapshot => {
                    products = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderProducts();
                    updateDashboard();
                    updateAnalytics();
                },
                error => {
                    console.error('Error loading products:', error);
                    if (error.code === 'permission-denied') {
                        showToast('Permission denied. Admin access required.', 'error');
                        setTimeout(() => auth.signOut(), 2000);
                    }
                }
            );
        }
        
        function loadOrders() {
            db.collection('orders').orderBy('createdAt', 'desc').onSnapshot(
                snapshot => {
                    orders = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderOrders();
                    updateDashboard();
                },
                error => {
                    console.error('Error loading orders:', error);
                    if (error.code === 'permission-denied') {
                        showToast('Permission denied. Admin access required.', 'error');
                    }
                }
            );
        }
        
        function loadFeedbacks() {
            console.log('Loading feedbacks...');
            const tbody = document.getElementById('feedbacks-table');
            if (!tbody) return;
            
            tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-500"><div class="inline-block loader mr-2"></div> Fetching feedbacks...</td></tr>';
            
            db.collection('feedbacks').orderBy('timestamp', 'desc').get().then(
                snapshot => {
                    console.log('Feedbacks loaded:', snapshot.size);
                    feedbacks = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderFeedbacks();
                }
            ).catch(
                error => {
                    console.error('Error loading feedbacks:', error);
                    tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-red-400">⚠️ Error loading feedbacks: ' + error.message + '</td></tr>';
                    showToast('Error loading feedbacks: ' + error.message, 'error');
                }
            );
        }
        
        function loadBugReports() {
            console.log('Loading bug reports...');
            const tbody = document.getElementById('bug-reports-table');
            if (!tbody) return;
            
            tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-500"><div class="inline-block loader mr-2"></div> Fetching bug reports...</td></tr>';
            
            db.collection('bug_reports').orderBy('timestamp', 'desc').get().then(
                snapshot => {
                    console.log('Bug reports loaded:', snapshot.size);
                    bugReports = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderBugReports();
                }
            ).catch(
                error => {
                    console.error('Error loading bug reports:', error);
                    tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-red-400">⚠️ Error loading bug reports: ' + error.message + '</td></tr>';
                    showToast('Error loading bug reports: ' + error.message, 'error');
                }
            );
        }

        function loadSettingsData() {
            console.log('Loading settings data...');
            
            // Check if settings form elements exist
            const deliveryCharge = document.getElementById('delivery-charge');
            const taxRate = document.getElementById('tax-rate');
            const minOrderValue = document.getElementById('min-order-value');
            const freeDeliveryAbove = document.getElementById('free-delivery-above');
            
            if (!deliveryCharge || !taxRate || !minOrderValue || !freeDeliveryAbove) {
                console.error('Settings form elements not found!');
                return;
            }
            
            // Load app settings
            db.collection('settings').doc('app_config').get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    deliveryCharge.value = (data.deliveryCharge || 0) / 100;
                    taxRate.value = data.taxRate || 0;
                    minOrderValue.value = (data.minOrderValue || 0) / 100;
                    freeDeliveryAbove.value = (data.freeDeliveryAbove || 0) / 100;
                }
            }).catch(err => {
                console.error('Error loading app settings:', err);
                showToast('Error loading settings: ' + err.message, 'error');
            });

            loadLoyaltySettings();
            loadFeaturedProducts();
            populateFeaturedProductSelect();
        }

        function loadUsers() {
            console.log('Loading users with real-time updates...');
            db.collection('users').onSnapshot(
                snapshot => {
                    users = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderUsers();
                    updateUserStats();
                },
                error => {
                    console.error('Error loading users:', error);
                    const tbody = document.getElementById('users-table');
                    if (tbody) {
                        tbody.innerHTML = '<tr><td colspan="10" class="px-6 py-12 text-center text-red-400">⚠️ Error: ' + error.message + '</td></tr>';
                    }
                }
            );
        }
        
        // Render Functions
        function renderProducts() {
            const tbody = document.getElementById('products-table');
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-12 text-center text-slate-500">No products found</td></tr>';
                return;
            }
            
            tbody.innerHTML = products.map(p => `
                <tr class="group hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center text-xl shadow-inner border border-white/5">
                                ${p.imageEmoji || '📦'}
                            </div>
                            <div>
                                <div class="font-medium text-white group-hover:text-primary-400 transition-colors">${p.name}</div>
                                <div class="text-xs text-slate-500">${p.brand || 'Generic'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 font-mono text-slate-400 text-xs">${p.barcode || 'N/A'}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-800 text-slate-300 border border-white/10">
                            ${p.category || 'Uncategorized'}
                        </span>
                    </td>
                    <td class="px-6 py-4 font-semibold text-white">₹${((p.price || 0) / 100).toFixed(2)}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <div class="w-full max-w-[60px] h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                <div class="h-full rounded-full ${p.stockQuantity < 10 ? 'bg-orange-500' : 'bg-emerald-500'}" style="width: ${Math.min(100, (p.stockQuantity/50)*100)}%"></div>
                            </div>
                            <span class="text-xs ${p.stockQuantity < 10 ? 'text-orange-400' : 'text-emerald-400'} font-medium">
                                ${p.stockQuantity || 0}
                            </span>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="editProduct('${p.id}')" class="p-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 rounded-lg transition-colors hover:scale-110" title="Edit">
                                <span class="material-symbols-rounded text-lg">edit</span>
                            </button>
                            <button onclick="deleteProduct('${p.id}')" class="p-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors hover:scale-110" title="Delete">
                                <span class="material-symbols-rounded text-lg">delete</span>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function renderOrders() {
            const tbody = document.getElementById('orders-table');
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-12 text-center text-slate-500">No orders recorded</td></tr>';
                return;
            }
            
            tbody.innerHTML = orders.slice(0, 50).map(o => {
                const date = o.createdAt ? new Date(o.createdAt.seconds * 1000).toLocaleString() : 'N/A';
                const total = (o.total || 0) / 100;
                const receiptId = o.receiptNo ? o.receiptNo.substring(0, 8).toUpperCase() : 'N/A';
                
                return `
                    <tr class="hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                        <td class="px-6 py-4 font-mono text-xs">
                            <span class="text-primary-400">#</span><span class="text-slate-400">${receiptId}</span>
                        </td>
                        <td class="px-6 py-4 font-mono text-slate-400 text-xs">
                            <span class="text-primary-400">#</span>${o.orderNumber || o.id.substr(0, 8)}
                        </td>
                        <td class="px-6 py-4 font-mono text-slate-500 text-xs">${o.exitCode || 'N/A'}</td>
                        <td class="px-6 py-4 text-slate-300 text-xs">${date}</td>
                        <td class="px-6 py-4">
                             <div class="flex -space-x-2">
                                ${(o.items || []).slice(0,3).map(i => `
                                    <div class="w-6 h-6 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center text-[10px]" title="${i.name}">
                                        ${i.imageEmoji || '📦'}
                                    </div>
                                `).join('')}
                                ${(o.items || []).length > 3 ? `<div class="w-6 h-6 rounded-full bg-slate-700 border border-slate-600 flex items-center justify-center text-[8px] text-white">+${(o.items || []).length - 3}</div>` : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4 font-semibold text-white">₹${total.toFixed(2)}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                                ${o.paymentMethod || 'Cash'}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderFeedbacks() {
            const tbody = document.getElementById('feedbacks-table');
            if (!tbody) return;
            if (feedbacks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-500">No feedbacks yet. Feedbacks from users will appear here.</td></tr>';
                return;
            }
            tbody.innerHTML = feedbacks.slice(0, 100).map(f => {
                let date = f.timestamp ? new Date(f.timestamp.seconds * 1000).toLocaleString() : 'N/A';
                const stars = Array(f.rating || 0).fill('⭐').join('');
                return `
                    <tr class="hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                        <td class="px-6 py-4 text-slate-300 text-xs"><span class="truncate max-w-xs block">${f.email || 'Anonymous'}</span></td>
                        <td class="px-6 py-4 text-sm text-yellow-400">${stars}</td>
                        <td class="px-6 py-4 text-slate-400 text-xs"><span class="truncate max-w-lg block">${f.message || ''}</span></td>
                        <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20">💬 ${f.category || 'General'}</span></td>
                        <td class="px-6 py-4 text-slate-400 text-xs flex items-center gap-2 justify-between">${date}
                            <button onclick="deleteFeedback('${f.id}')" class="p-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors hover:scale-110" title="Delete Feedback">
                                <span class="material-symbols-rounded text-lg">delete</span>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Delete Feedback (moved to global scope)
        async function deleteFeedback(id) {
            if (!confirm('Delete this feedback?')) return;
            try {
                await db.collection('feedbacks').doc(id).delete();
                showToast('Feedback deleted', 'success');
                loadFeedbacks();
            } catch (err) {
                showToast('Error deleting feedback: ' + err.message, 'error');
            }
        }
        
        function renderBugReports() {
            const tbody = document.getElementById('bug-reports-table');
            if (!tbody) return;
            if (bugReports.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-500">No bug reports yet. Bug reports from users will appear here.</td></tr>';
                return;
            }
            tbody.innerHTML = bugReports.slice(0, 100).map(b => {
                let date = b.timestamp ? new Date(b.timestamp.seconds * 1000).toLocaleString() : 'N/A';
                const statusColor = b.status === 'open' ? 'bg-red-500/10 text-red-400 border-red-500/20' : 'bg-green-500/10 text-green-400 border-green-500/20';
                return `
                    <tr class="hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                        <td class="px-6 py-4 text-slate-300 text-xs"><span class="truncate max-w-xs block">${b.email || 'Anonymous'}</span></td>
                        <td class="px-6 py-4 text-white text-xs font-semibold"><span class="truncate max-w-sm block">${b.title || 'Untitled'}</span></td>
                        <td class="px-6 py-4 text-slate-400 text-xs"><span class="truncate max-w-lg block">${b.description || ''}</span></td>
                        <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${statusColor} border capitalize">${b.status || 'open'}</span></td>
                        <td class="px-6 py-4 text-slate-400 text-xs flex items-center gap-2 justify-between">${date}
                            <button onclick="deleteBugReport('${b.id}')" class="p-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors hover:scale-110" title="Delete Bug Report">
                                <span class="material-symbols-rounded text-lg">delete</span>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Delete Bug Report (moved to global scope)
        async function deleteBugReport(id) {
            if (!confirm('Delete this bug report?')) return;
            try {
                await db.collection('bug_reports').doc(id).delete();
                showToast('Bug report deleted', 'success');
                loadBugReports();
            } catch (err) {
                showToast('Error deleting bug report: ' + err.message, 'error');
            }
        }
        
        // Updates
        function animateCounter(element, target, duration = 800) {
            if (!element) return;
            let current = 0;
            const increment = target / (duration / 16);
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = target;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 16);
        }

        function updateDashboard() {
            const statTotalProducts = document.getElementById('stat-total-products');
            const statLowStock = document.getElementById('stat-low-stock');
            const statTotalOrders = document.getElementById('stat-total-orders');
            const statTotalRevenue = document.getElementById('stat-total-revenue');
            const lowStockDiv = document.getElementById('low-stock-list');
            
            // Only update if dashboard elements exist (user is on dashboard tab)
            if (!statTotalProducts || !statLowStock || !statTotalOrders || !statTotalRevenue || !lowStockDiv) {
                return;
            }
            
            animateCounter(statTotalProducts, products.length);
            animateCounter(statLowStock, products.filter(p => (p.stockQuantity || 0) < 10).length);
            animateCounter(statTotalOrders, orders.length);
            
            const totalRevenue = orders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
            statTotalRevenue.textContent = '₹' + totalRevenue.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            
            const lowStockItems = products.filter(p => (p.stockQuantity || 0) < 10);
            
            if (lowStockItems.length === 0) {
                lowStockDiv.innerHTML = '<div class="text-center p-4 border border-dashed border-slate-700 rounded-xl text-slate-500 text-sm animate-fade">Stock levels are healthy</div>';
            } else {
                lowStockDiv.innerHTML = lowStockItems.map((p, i) => `
                    <div class="flex items-center justify-between p-3 bg-orange-500/5 border border-orange-500/10 rounded-xl hover:bg-orange-500/10 transition-colors animate-slide-up" style="animation-delay: ${i * 0.05}s;">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded bg-slate-800 flex items-center justify-center">${p.imageEmoji || '📦'}</div>
                            <div>
                                <div class="font-medium text-slate-200 text-sm">${p.name}</div>
                                <div class="text-xs text-orange-400 font-mono">Qty: ${p.stockQuantity}</div>
                            </div>
                        </div>
                        <button onclick="openRestockModal('${p.id}')" class="px-3 py-1 bg-slate-800 hover:bg-slate-700 text-xs text-white rounded border border-white/5 transition-colors hover:scale-105">Restock</button>
                    </div>
                `).join('');
            }
        }
        
        let topProductsChart = null;
        let categoryChart = null;
        let userActivityChart = null;
        let stockStatusChart = null;

        async function loadAnalyticsData() {
            try {
                showToast('Loading analytics data...', 'info');
                
                // Fetch data
                const ordersSnap = await db.collection('orders').orderBy('timestamp', 'desc').get();
                const usersSnap = await db.collection('users').get();
                const productsSnap = await db.collection('products').get();
                
                const orders = ordersSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const users = usersSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const productsData = productsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // User Activity Pie Chart (Active vs Inactive)
                const now = Date.now();
                const activeUsers = users.filter(u => {
                    const lastActive = (u.lastActive?.seconds || u.createdAt?.seconds || 0) * 1000;
                    return (now - lastActive) < (30 * 24 * 60 * 60 * 1000); // Active in last 30 days
                }).length;
                const inactiveUsers = users.length - activeUsers;
                
                if (userActivityChart) userActivityChart.destroy();
                const ctxUserActivity = document.getElementById('user-activity-chart');
                
                if (ctxUserActivity && users.length > 0) {
                    userActivityChart = new Chart(ctxUserActivity, {
                        type: 'doughnut',
                        data: {
                            labels: ['Active Users', 'Inactive Users'],
                            datasets: [{
                                data: [activeUsers, inactiveUsers],
                                backgroundColor: ['#3b82f6', '#64748b'],
                                borderColor: 'rgba(15, 23, 42, 0.8)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    position: 'bottom', 
                                    labels: { color: '#cbd5e1', padding: 15, font: { size: 12 } } 
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                    titleColor: '#cbd5e1',
                                    bodyColor: '#cbd5e1',
                                    borderColor: 'rgba(255, 255, 255, 0.1)',
                                    borderWidth: 1,
                                    padding: 12,
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.parsed || 0;
                                            const percent = users.length > 0 ? ((value / users.length) * 100).toFixed(1) : 0;
                                            return context.label + ': ' + value + ' (' + percent + '%)';
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else if (ctxUserActivity) {
                    ctxUserActivity.parentElement.innerHTML = '<p class="text-slate-500 text-center py-8">No user data</p>';
                }
                
                // Stock Status Pie Chart
                const stockStatus = {
                    'In Stock': productsData.filter(p => (p.stockQuantity || 0) > 10).length,
                    'Low Stock': productsData.filter(p => (p.stockQuantity || 0) > 0 && (p.stockQuantity || 0) <= 10).length,
                    'Out of Stock': productsData.filter(p => (p.stockQuantity || 0) === 0).length
                };
                
                if (stockStatusChart) stockStatusChart.destroy();
                const ctxStockStatus = document.getElementById('stock-status-chart');
                const ssEntries = Object.entries(stockStatus).filter(e => e[1] > 0);
                
                if (ctxStockStatus && ssEntries.length > 0) {
                    stockStatusChart = new Chart(ctxStockStatus, {
                        type: 'doughnut',
                        data: {
                            labels: ssEntries.map(e => e[0]),
                            datasets: [{
                                data: ssEntries.map(e => e[1]),
                                backgroundColor: ['#34d399', '#f59e0b', '#ef4444'],
                                borderColor: 'rgba(15, 23, 42, 0.8)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    position: 'bottom', 
                                    labels: { color: '#cbd5e1', padding: 15, font: { size: 12 } } 
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                    titleColor: '#cbd5e1',
                                    bodyColor: '#cbd5e1',
                                    borderColor: 'rgba(255, 255, 255, 0.1)',
                                    borderWidth: 1,
                                    padding: 12,
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.parsed || 0;
                                            const total = productsData.length;
                                            const percent = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                            return context.label + ': ' + value + ' products (' + percent + '%)';
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else if (ctxStockStatus) {
                    ctxStockStatus.parentElement.innerHTML = '<p class="text-slate-500 text-center py-8">No product data</p>';
                }
                
                showToast('Analytics data loaded successfully', 'success');
            } catch (err) {
                console.error('Error loading analytics:', err);
                showToast('Error loading analytics: ' + err.message, 'error');
            }
        }

        function updateAnalytics() {
            const topProducts = [...products].sort((a,b) => (b.purchaseCount || 0) - (a.purchaseCount || 0)).slice(0, 5);
            
            if (topProductsChart) topProductsChart.destroy();
            if (categoryChart) categoryChart.destroy();
            
            const ctxProducts = document.getElementById('top-products-chart');
            if (!ctxProducts) return;

            if (topProducts.length === 0) {
                ctxProducts.parentElement.innerHTML = '<p class="text-slate-500 text-center text-sm">No sales data yet</p>';
            } else {
                const productLabels = topProducts.map(p => p.name);
                const productData = topProducts.map(p => p.purchaseCount || 0);
                const productColors = ['#34d399', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6'];
                
                topProductsChart = new Chart(ctxProducts, {
                    type: 'doughnut',
                    data: {
                        labels: productLabels,
                        datasets: [{
                            data: productData,
                            backgroundColor: productColors,
                            borderColor: 'rgba(15, 23, 42, 0.8)',
                            borderWidth: 2,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#cbd5e1', font: { size: 12, weight: '500' }, padding: 15, usePointStyle: true }
                            }
                        }
                    }
                });
            }
            
            const categories = {};
            products.forEach(p => { categories[p.category] = (categories[p.category] || 0) + 1; });
            const ctxCategory = document.getElementById('category-chart');
            const catEntries = Object.entries(categories).sort((a, b) => b[1] - a[1]);
            
            if (catEntries.length === 0) {
                ctxCategory.parentElement.innerHTML = '<p class="text-slate-500 text-center text-sm">No categories found</p>';
            } else {
                const catLabels = catEntries.map(e => e[0]);
                const catData = catEntries.map(e => e[1]);
                const catColors = ['#3b82f6', '#34d399', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];
                
                categoryChart = new Chart(ctxCategory, {
                    type: 'doughnut',
                    data: {
                        labels: catLabels.map(c => c.charAt(0).toUpperCase() + c.slice(1)),
                        datasets: [{
                            data: catData,
                            backgroundColor: catColors.slice(0, catLabels.length),
                            borderColor: 'rgba(15, 23, 42, 0.8)',
                            borderWidth: 2,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#cbd5e1', font: { size: 12, weight: '500' }, padding: 15, usePointStyle: true }
                            }
                        }
                    }
                });
            }
        }
        
        function filterProducts() {
            const search = document.getElementById('search-products').value.toLowerCase();
            const filtered = products.filter(p => 
                (p.name || '').toLowerCase().includes(search) ||
                (p.barcode || '').toLowerCase().includes(search) ||
                (p.category || '').toLowerCase().includes(search)
            );
            
            const tbody = document.getElementById('products-table');
            if(filtered.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-12 text-center text-slate-500">No matches found</td></tr>';
            } else {
                const originalProducts = products;
                products = filtered;
                renderProducts();
                products = originalProducts;
            }
        }
        
        function renderUsers() {
            const tbody = document.getElementById('users-table');
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="px-6 py-12 text-center text-slate-500">No users found</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(u => {
                const userOrders = orders.filter(o => o.userId === u.id || o.email === u.email);
                const totalSpent = userOrders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
                const lastActive = u.lastLoginTime ? new Date(u.lastLoginTime.seconds * 1000).toLocaleDateString() : 'Never';
                const isActive = !u.isSuspended;
                const statusColor = isActive ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20';
                const statusText = isActive ? 'Active' : 'Suspended';
                const suspendBtnColor = isActive ? 'bg-red-500/20 hover:bg-red-500/30 text-red-300' : 'bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300';
                const suspendBtnText = isActive ? '🚫 Suspend' : '✅ Activate';
                const role = u.role || 'customer';
                const phone = u.phone || 'N/A';
                
                // Avatar: Show Google profile pic if available, otherwise emoji
                const avatarEmoji = u.avatarEmoji || '👤';
                let avatarHtml = '';
                if (u.photoURL) {
                    avatarHtml = `<img src="${u.photoURL}" alt="${u.name}" class="w-10 h-10 rounded-full border-2 border-white/10" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" /><div style="display:none;" class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-xl">${avatarEmoji}</div>`;
                } else {
                    avatarHtml = `<div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-xl">${avatarEmoji}</div>`;
                }
                
                return `
                    <tr class="group hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                        <td class="px-6 py-4">${avatarHtml}</td>
                        <td class="px-6 py-4 text-slate-300 text-xs">${u.email || 'N/A'}</td>
                        <td class="px-6 py-4 text-white font-medium">${u.name || 'Unknown'}</td>
                        <td class="px-6 py-4 text-slate-400 text-xs">${phone}</td>
                        <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-800 text-slate-300 border border-white/10 capitalize">${role}</span></td>
                        <td class="px-6 py-4 text-white font-semibold">₹${totalSpent.toFixed(2)}</td>
                        <td class="px-6 py-4 text-slate-300">${userOrders.length}</td>
                        <td class="px-6 py-4 text-slate-400 text-xs">${lastActive}</td>
                        <td class="px-6 py-4"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${statusColor}">${statusText}</span></td>
                        <td class="px-6 py-4 text-right">
                            <div class="flex items-center justify-end gap-2">
                                <button onclick="toggleUserStatus('${u.id}', ${isActive})" class="px-3 py-1.5 rounded-lg ${suspendBtnColor} border border-white/10 text-xs font-semibold transition-all hover:scale-105" title="${isActive ? 'Suspend this user' : 'Activate this user'}">
                                    ${suspendBtnText}
                                </button>
                                <button onclick="viewUserDetails('${u.id}')" class="p-2 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 transition-colors hover:scale-110 border border-white/10" title="View Details">
                                    <span class="material-symbols-rounded text-lg">info</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateUserStats() {
            const totalUsersEl = document.getElementById('stat-total-users');
            const activeUsersEl = document.getElementById('stat-active-users');
            const suspendedUsersEl = document.getElementById('stat-suspended-users');
            
            if (!totalUsersEl || !activeUsersEl || !suspendedUsersEl) {
                return;
            }
            
            totalUsersEl.textContent = users.length;
            const activeUsers = users.filter(u => !u.isSuspended).length;
            const suspendedUsers = users.filter(u => u.isSuspended).length;
            activeUsersEl.textContent = activeUsers;
            suspendedUsersEl.textContent = suspendedUsers;
        }

        function filterUsers() {
            const search = document.getElementById('search-users').value.toLowerCase();
            const filtered = users.filter(u => 
                (u.email || '').toLowerCase().includes(search) ||
                (u.name || '').toLowerCase().includes(search)
            );
            
            const tbody = document.getElementById('users-table');
            if(filtered.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="10" class="px-6 py-12 text-center text-slate-500">No matches found</td></tr>';
            } else {
                const originalUsers = users;
                users = filtered;
                renderUsers();
                users = originalUsers;
            }
        }

        function toggleUserStatus(userId, isCurrentlyActive) {
            const action = isCurrentlyActive ? 'suspend' : 'activate';
            const newStatus = isCurrentlyActive; // If currently active (true), set isSuspended to true
            
            if (!confirm(`Are you sure you want to ${action} this user?`)) return;
            
            db.collection('users').doc(userId).update({
                isSuspended: newStatus,
                lastStatusChange: firebase.firestore.FieldValue.serverTimestamp(),
                statusChangedBy: auth.currentUser.email
            }).then(() => {
                showToast(`User ${action}d successfully! 🎉`, 'success');
            }).catch(err => {
                console.error('Error toggling user status:', err);
                showToast('Error: ' + err.message, 'error');
            });
        }

        function viewUserDetails(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const userOrders = orders.filter(o => o.userId === userId || o.email === user.email);
            const totalSpent = userOrders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
            
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">User Details</h3>
                        <button onclick="closeModal()" class="text-slate-500 hover:text-white transition-colors"><span class="material-symbols-rounded">close</span></button>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-slate-400 text-sm font-medium mb-3">Personal Information</h4>
                            <div class="glass-panel p-4 rounded-xl space-y-2">
                                <div><span class="text-slate-500">Email:</span> <span class="text-white">${user.email}</span></div>
                                <div><span class="text-slate-500">Name:</span> <span class="text-white">${user.name || 'N/A'}</span></div>
                                <div><span class="text-slate-500">Role:</span> <span class="text-white capitalize">${user.role || 'customer'}</span></div>
                                <div><span class="text-slate-500">Status:</span> <span class="${user.isSuspended ? 'text-red-400' : 'text-emerald-400'}">${user.isSuspended ? 'Suspended' : 'Active'}</span></div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-slate-400 text-sm font-medium mb-3">Spending Analytics</h4>
                            <div class="glass-panel p-4 rounded-xl space-y-2">
                                <div><span class="text-slate-500">Total Spent:</span> <span class="text-white font-semibold">₹${totalSpent.toFixed(2)}</span></div>
                                <div><span class="text-slate-500">Total Orders:</span> <span class="text-white">${userOrders.length}</span></div>
                                <div><span class="text-slate-500">Avg Order Value:</span> <span class="text-white">₹${(userOrders.length > 0 ? totalSpent / userOrders.length : 0).toFixed(2)}</span></div>
                            </div>
                        </div>
                        
                        <div class="pt-4 flex gap-3">
                            <button onclick="editUserInfo('${user.id}')" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium transition-colors">
                                Edit Info
                            </button>
                            <button onclick="toggleUserStatus('${user.id}', ${!user.isSuspended})" class="flex-1 px-4 py-2 ${user.isSuspended ? 'bg-emerald-600 hover:bg-emerald-500' : 'bg-red-600 hover:bg-red-500'} text-white rounded-lg font-medium transition-colors">
                                ${user.isSuspended ? 'Activate' : 'Suspend'}
                            </button>
                            <button onclick="closeModal()" class="flex-1 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg font-medium transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
        }

        function editUserInfo(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">Edit User Information</h3>
                        <button onclick="closeModal()" class="text-slate-500 hover:text-white transition-colors"><span class="material-symbols-rounded">close</span></button>
                    </div>
                    
                    <form onsubmit="saveUserInfo(event, '${user.id}')" class="space-y-5">
                        <div>
                            <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Email Address</label>
                            <input type="email" id="edit-user-email" name="email" value="${user.email}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="user@example.com">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Full Name</label>
                            <input type="text" id="edit-user-name" name="name" value="${user.name || ''}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="John Doe">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Phone Number</label>
                            <input type="tel" id="edit-user-phone" name="phone" value="${user.phone || ''}" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="+91-XXXXXXXXXX">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Address</label>
                            <textarea id="edit-user-address" name="address" rows="3" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Street Address, City, State, Postal Code">${user.address || ''}</textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">City</label>
                                <input type="text" id="edit-user-city" name="city" value="${user.city || ''}" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="City">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">State</label>
                                <input type="text" id="edit-user-state" name="state" value="${user.state || ''}" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="State">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Postal Code</label>
                                <input type="text" id="edit-user-postal" name="postalCode" value="${user.postalCode || ''}" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="123456">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Country</label>
                                <input type="text" id="edit-user-country" name="country" value="${user.country || 'India'}" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Country">
                            </div>
                        </div>
                        
                        <div class="pt-4 flex gap-3">
                            <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-primary-600 to-emerald-600 hover:from-primary-500 hover:to-emerald-500 text-white rounded-xl font-bold shadow-lg shadow-primary-500/20 transition-all transform active:scale-95">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
        }

        async function saveUserInfo(event, userId) {
            event.preventDefault();
            
            const updates = {
                email: document.getElementById('edit-user-email').value.trim(),
                name: document.getElementById('edit-user-name').value.trim(),
                phone: document.getElementById('edit-user-phone').value.trim(),
                address: document.getElementById('edit-user-address').value.trim(),
                city: document.getElementById('edit-user-city').value.trim(),
                state: document.getElementById('edit-user-state').value.trim(),
                postalCode: document.getElementById('edit-user-postal').value.trim(),
                country: document.getElementById('edit-user-country').value.trim(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('users').doc(userId).update(updates);
                showToast('User information updated successfully', 'success');
                closeModal();
                loadUsers();
            } catch (err) {
                showToast('Error updating user: ' + err.message, 'error');
            }
        }
        
        // Modals
        function openAddProductModal() {
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">Add Product</h3>
                        <button onclick="closeModal()" class="text-slate-500 hover:text-white transition-colors"><span class="material-symbols-rounded">close</span></button>
                    </div>
                    <form onsubmit="addProduct(event)" class="space-y-5">
                        <div class="grid grid-cols-2 gap-5">
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Barcode</label>
                                <input type="text" name="barcode" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all placeholder-slate-600" placeholder="Scan or enter...">
                            </div>
                             <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Brand</label>
                                <input type="text" name="brand" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="e.g. Nestle">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Product Name</label>
                            <input type="text" name="name" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="e.g. Maggi Noodles">
                        </div>

                        <div class="grid grid-cols-2 gap-5">
                             <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Category</label>
                                <input type="text" name="category" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="e.g. Snacks">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Emoji Icon</label>
                                <input type="text" name="emoji" placeholder="📦" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-5">
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Price (₹)</label>
                                <div class="relative">
                                    <span class="absolute left-4 top-2.5 text-slate-500">₹</span>
                                    <input type="number" name="price" step="0.01" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg pl-8 pr-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Initial Stock</label>
                                <input type="number" name="stock" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                        </div>

                        <div class="pt-4 flex gap-3">
                            <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-primary-600 to-emerald-600 hover:from-primary-500 hover:to-emerald-500 text-white rounded-xl font-bold shadow-lg shadow-primary-500/20 transition-all transform active:scale-95">Create Product</button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="p-8">
                      <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">Edit Product</h3>
                        <button onclick="closeModal()" class="text-slate-500 hover:text-white transition-colors"><span class="material-symbols-rounded">close</span></button>
                    </div>
                    <form onsubmit="updateProduct(event, '${id}')" class="space-y-5">
                        <div class="grid grid-cols-2 gap-5">
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Barcode</label>
                                <input type="text" name="barcode" value="${product.barcode || ''}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                             <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Brand</label>
                                <input type="text" name="brand" value="${product.brand || ''}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Name</label>
                            <input type="text" name="name" value="${product.name || ''}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        </div>

                         <div class="grid grid-cols-2 gap-5">
                             <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Category</label>
                                <input type="text" name="category" value="${product.category || ''}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Emoji</label>
                                <input type="text" name="emoji" value="${product.imageEmoji || '📦'}" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-5">
                             <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Price (₹)</label>
                                <input type="number" name="price" step="0.01" value="${((product.price || 0) / 100).toFixed(2)}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                             <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wide">Stock</label>
                                <input type="number" name="stock" value="${product.stockQuantity || 0}" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                            </div>
                        </div>

                        <div class="pt-4 flex gap-3">
                            <button type="button" onclick="closeModal()" class="flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-4 py-3 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-bold shadow-lg shadow-primary-500/20 transition-all">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
        }
        
        // Operations
        function addProduct(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const product = {
                barcode: formData.get('barcode'),
                name: formData.get('name'),
                category: formData.get('category'),
                brand: formData.get('brand'),
                price: Math.round(parseFloat(formData.get('price')) * 100),
                stockQuantity: parseInt(formData.get('stock')),
                imageEmoji: formData.get('emoji') || '📦',
                isActive: true,
                purchaseCount: 0,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('products').add(product)
                .then(() => { showToast('Product added successfully', 'success'); closeModal(); })
                .catch(err => showToast('Error: ' + err.message, 'error'));
        }

        function updateProduct(e, id) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const updates = {
                barcode: formData.get('barcode'),
                name: formData.get('name'),
                category: formData.get('category'),
                brand: formData.get('brand'),
                price: Math.round(parseFloat(formData.get('price')) * 100),
                stockQuantity: parseInt(formData.get('stock')),
                imageEmoji: formData.get('emoji') || '📦',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('products').doc(id).update(updates)
                .then(() => { showToast('Product updated successfully', 'success'); closeModal(); })
                .catch(err => showToast('Error: ' + err.message, 'error'));
        }

        function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            db.collection('products').doc(id).delete()
                .then(() => showToast('Product deleted', 'success'))
                .catch(err => showToast('Error: ' + err.message, 'error'));
        }
        
        // UI Helpers
        let ratingsLoaded = false;  // Track if ratings data has been loaded
        let analyticsLoaded = false;  // Track if analytics data has been loaded
        let feedbacksLoaded = false;  // Track if feedbacks data has been loaded
        let supportLoaded = false;  // Track if support tickets have been loaded
        let bugReportsLoaded = false;  // Track if bug reports have been loaded
        let settingsLoaded = false;  // Track if settings have been loaded
        
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
                el.style.display = 'none'; // Force hide
            });
            
            // Show target tab
            const targetTab = document.getElementById('tab-' + tabId);
            if (targetTab) {
                targetTab.classList.remove('hidden');
                targetTab.style.display = 'block'; // Force show
                
                // Re-trigger animations to prevent blank content
                targetTab.querySelectorAll('.animate-enter, .animate-slide-up, .spotlight-card, .glass-panel').forEach(el => {
                    el.style.animation = 'none';
                    el.offsetHeight; /* trigger reflow */
                    el.style.animation = null; 
                });
            }
            
            // Update menu state
            document.querySelectorAll('.menu-item').forEach(el => {
                el.classList.remove('active-menu', 'text-white', 'bg-primary-500/20');
                el.classList.add('text-slate-300');
            });
            const activeItem = document.querySelector(`.menu-item[data-target="${tabId}"]`);
            if(activeItem) {
                activeItem.classList.add('active-menu', 'text-white', 'bg-primary-500/20');
                activeItem.classList.remove('text-slate-300');
            }

            // Load specific data on demand
            if (tabId === 'ratings' && !ratingsLoaded) { setTimeout(() => loadRatingsData(), 100); ratingsLoaded = true; }
            if (tabId === 'analytics' && !analyticsLoaded) { setTimeout(() => loadAnalyticsData(), 100); analyticsLoaded = true; }
            if (tabId === 'feedbacks' && !feedbacksLoaded) { setTimeout(() => loadFeedbacks(), 100); feedbacksLoaded = true; }
            if (tabId === 'support' && !supportLoaded) { setTimeout(() => loadSupportTickets(), 100); supportLoaded = true; }
            if (tabId === 'bug-reports' && !bugReportsLoaded) { setTimeout(() => loadBugReports(), 100); bugReportsLoaded = true; }
            if (tabId === 'settings' && !settingsLoaded) { setTimeout(() => loadSettingsData(), 100); settingsLoaded = true; }
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function showToast(message, type = 'normal') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            let borderColor = 'border-slate-700';
            let icon = 'info';
            let iconColor = 'text-blue-400';
            
            if(type === 'success') { borderColor = 'border-emerald-500/50'; icon = 'check_circle'; iconColor = 'text-emerald-400'; }
            if(type === 'error') { borderColor = 'border-red-500/50'; icon = 'error'; iconColor = 'text-red-400'; }

            toast.className = `glass-panel pointer-events-auto flex items-center gap-3 px-5 py-4 rounded-xl shadow-2xl border ${borderColor} animate-enter min-w-[300px]`;
            toast.innerHTML = `
                <span class="material-symbols-rounded ${iconColor}">${icon}</span>
                <span class="text-sm font-medium text-white">${message}</span>
            `;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Toggle Theme (Simplified for Single Dark Mode Focus)
        function toggleTheme() {
            // Feature hidden in this premium dark version, but logic kept
            document.documentElement.classList.toggle('dark');
        }

        // CSV & PRINT FUNCTIONS
        function downloadCSV(filename, data) {
            const csv = data;
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function exportProductsCSV() {
            let csv = 'Name,Barcode,Category,Brand,Price (₹),Stock\n';
            products.forEach(p => {
                csv += `"${p.name || ''}","${p.barcode || ''}","${p.category || ''}","${p.brand || ''}","${((p.price || 0) / 100).toFixed(2)}","${p.stockQuantity || 0}"\n`;
            });
            downloadCSV('products_' + new Date().toISOString().split('T')[0] + '.csv', csv);
            showToast('Products exported to CSV', 'success');
        }

        function exportOrdersCSV() {
            let csv = 'Receipt ID,Exit Code,Date,Items,Total (₹)\n';
            orders.forEach(o => {
                const date = o.createdAt ? new Date(o.createdAt.seconds * 1000).toLocaleString() : 'N/A';
                const itemCount = (o.items || []).length;
                const total = ((o.total || 0) / 100).toFixed(2);
                const receiptId = o.receiptNo ? o.receiptNo.substring(0, 8).toUpperCase() : 'N/A';
                const exitCode = o.exitCode || 'N/A';
                csv += `"${receiptId}","${exitCode}","${date}","${itemCount}","${total}"\n`;
            });
            downloadCSV('orders_' + new Date().toISOString().split('T')[0] + '.csv', csv);
            showToast('Orders exported to CSV', 'success');
        }

        function exportAnalyticsCSV() {
            let csv = 'Metric,Value\n';
            csv += `Total Products,${products.length}\n`;
            csv += `Total Orders,${orders.length}\n`;
            csv += `Low Stock Items,${products.filter(p => (p.stockQuantity || 0) < 10).length}\n`;
            const totalRevenue = orders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
            csv += `Total Revenue (₹),${totalRevenue.toFixed(2)}\n`;
            csv += `\nTop Products\n`;
            const topProducts = [...products].sort((a,b) => (b.purchaseCount || 0) - (a.purchaseCount || 0)).slice(0, 5);
            topProducts.forEach(p => {
                csv += `"${p.name}","${p.purchaseCount || 0} sales"\n`;
            });
            downloadCSV('analytics_' + new Date().toISOString().split('T')[0] + '.csv', csv);
            showToast('Analytics exported to CSV', 'success');
        }

        function exportFeedbacksCSV() {
            let csv = 'Email,Rating,Category,Message,Date\n';
            feedbacks.forEach(f => {
                let date = 'N/A';
                if (f.timestamp && f.timestamp.seconds) {
                    date = new Date(f.timestamp.seconds * 1000).toLocaleString();
                }
                const email = f.email || f.userId || 'Anonymous';
                const rating = f.rating || 0;
                const category = f.category || 'general';
                const message = (f.message || '').replace(/"/g, '""');
                csv += `"${email}","${rating}","${category}","${message}","${date}"\n`;
            });
            downloadCSV('feedbacks_' + new Date().toISOString().split('T')[0] + '.csv', csv);
            showToast('Feedbacks exported to CSV', 'success');
        }

        function exportBugReportsCSV() {
            let csv = 'Email,Title,Description,Status,Date\n';
            bugReports.forEach(b => {
                let date = 'N/A';
                if (b.timestamp && b.timestamp.seconds) {
                    date = new Date(b.timestamp.seconds * 1000).toLocaleString();
                }
                const email = b.email || b.userId || 'Anonymous';
                const title = (b.title || '').replace(/"/g, '""');
                const description = (b.description || '').replace(/"/g, '""');
                const status = b.status || 'open';
                csv += `"${email}","${title}","${description}","${status}","${date}"\n`;
            });
            downloadCSV('bug_reports_' + new Date().toISOString().split('T')[0] + '.csv', csv);
            showToast('Bug reports exported to CSV', 'success');
        }

        function exportUsersCSV() {
            let csv = 'Email,Name,Role,Total Spent (₹),Orders,Last Active,Status\n';
            users.forEach(u => {
                const userOrders = orders.filter(o => o.userId === u.id || o.email === u.email);
                const totalSpent = userOrders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
                const lastActive = u.lastLoginTime ? new Date(u.lastLoginTime.seconds * 1000).toLocaleDateString() : 'Never';
                const status = u.isSuspended ? 'Suspended' : 'Active';
                csv += `"${u.email}","${u.name || ''}","${u.role || 'customer'}","${totalSpent.toFixed(2)}","${userOrders.length}","${lastActive}","${status}"\n`;
            });
            downloadCSV('users_' + new Date().toISOString().split('T')[0] + '.csv', csv);
            showToast('Users exported to CSV', 'success');
        }

        function printProducts() {
            let html = '<h1>Product Inventory Report</h1>';
            html += '<p>Generated: ' + new Date().toLocaleString() + '</p>';
            html += '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Name</th><th>Barcode</th><th>Category</th><th>Price</th><th>Stock</th></tr>';
            products.forEach(p => {
                html += `<tr><td>${p.name || ''}</td><td>${p.barcode || ''}</td><td>${p.category || ''}</td><td>₹${((p.price || 0) / 100).toFixed(2)}</td><td>${p.stockQuantity || 0}</td></tr>`;
            });
            html += '</table>';
            openPrintWindow(html);
        }

        function printOrders() {
            let html = '<h1>Orders Report</h1>';
            html += '<p>Generated: ' + new Date().toLocaleString() + '</p>';
            html += '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Receipt ID</th><th>Exit Code</th><th>Date</th><th>Items</th><th>Total</th></tr>';
            orders.forEach(o => {
                const date = o.createdAt ? new Date(o.createdAt.seconds * 1000).toLocaleString() : 'N/A';
                const itemCount = (o.items || []).length;
                const total = ((o.total || 0) / 100).toFixed(2);
                const receiptId = o.receiptNo ? o.receiptNo.substring(0, 8).toUpperCase() : 'N/A';
                const exitCode = o.exitCode || 'N/A';
                html += `<tr><td>${receiptId}</td><td>${exitCode}</td><td>${date}</td><td>${itemCount}</td><td>₹${total}</td></tr>`;
            });
            html += '</table>';
            openPrintWindow(html);
        }

        function printAnalytics() {
            const topProducts = [...products].sort((a,b) => (b.purchaseCount || 0) - (a.purchaseCount || 0)).slice(0, 5);
            const totalRevenue = orders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
            let html = '<h1>Analytics Report</h1>';
            html += '<p>Generated: ' + new Date().toLocaleString() + '</p>';
            html += '<h3>Summary</h3>';
            html += `<p>Total Products: ${products.length}</p>`;
            html += `<p>Total Orders: ${orders.length}</p>`;
            html += `<p>Low Stock Items: ${products.filter(p => (p.stockQuantity || 0) < 10).length}</p>`;
            html += `<p>Total Revenue: ₹${totalRevenue.toFixed(2)}</p>`;
            html += '<h3>Top 5 Products</h3>';
            html += '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Product</th><th>Sales</th></tr>';
            topProducts.forEach(p => {
                html += `<tr><td>${p.name}</td><td>${p.purchaseCount || 0}</td></tr>`;
            });
            html += '</table>';
            openPrintWindow(html);
        }

        function printFeedbacks() {
            let html = '<h1>Feedbacks Report</h1>';
            html += '<p>Generated: ' + new Date().toLocaleString() + '</p>';
            html += '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Email</th><th>Rating</th><th>Category</th><th>Message</th></tr>';
            feedbacks.forEach(f => {
                const email = f.email || f.userId || 'Anonymous';
                const rating = f.rating || 0;
                const category = f.category || 'general';
                const message = f.message || '';
                html += `<tr><td>${email}</td><td>${rating}/5</td><td>${category}</td><td>${message.substring(0, 100)}</td></tr>`;
            });
            html += '</table>';
            openPrintWindow(html);
        }

        function printBugReports() {
            let html = '<h1>Bug Reports</h1>';
            html += '<p>Generated: ' + new Date().toLocaleString() + '</p>';
            html += '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Email</th><th>Title</th><th>Status</th><th>Description</th></tr>';
            bugReports.forEach(b => {
                const email = b.email || b.userId || 'Anonymous';
                const title = b.title || '';
                const status = b.status || 'open';
                const description = (b.description || '').substring(0, 100);
                html += `<tr><td>${email}</td><td>${title}</td><td>${status}</td><td>${description}</td></tr>`;
            });
            html += '</table>';
            openPrintWindow(html);
        }

        function printUsers() {
            let html = '<h1>Users Report</h1>';
            html += '<p>Generated: ' + new Date().toLocaleString() + '</p>';
            html += '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Email</th><th>Name</th><th>Role</th><th>Total Spent (₹)</th><th>Orders</th><th>Status</th></tr>';
            users.forEach(u => {
                const userOrders = orders.filter(o => o.userId === u.id || o.email === u.email);
                const totalSpent = userOrders.reduce((sum, o) => sum + ((o.total || 0) / 100), 0);
                const status = u.isSuspended ? 'Suspended' : 'Active';
                html += `<tr><td>${u.email}</td><td>${u.name || ''}</td><td>${u.role || 'customer'}</td><td>₹${totalSpent.toFixed(2)}</td><td>${userOrders.length}</td><td>${status}</td></tr>`;
            });
            html += '</table>';
            openPrintWindow(html);
        }

        function openPrintWindow(html) {
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write(`<html><head><title>Print Report</title><style>body{font-family:Arial;margin:20px;} h1{color:#333;} table{border-collapse:collapse; width:100%;} th,td{border:1px solid #ddd; padding:8px; text-align:left;} th{background-color:#f2f2f2;}</style></head><body>${html}</body></html>`);
            printWindow.document.close();
            printWindow.print();
        }

        function globalSearch(query) {
            const searchQuery = query.toLowerCase().trim();
            
            // Show search tab and hide no results message
            const searchNavBtn = document.getElementById('search-nav-btn');
            const noResults = document.getElementById('search-no-results');
            
            if (!searchQuery) {
                if (searchNavBtn) searchNavBtn.style.display = 'none';
                if (noResults) noResults.style.display = 'block';
                return;
            }
            
            if (searchNavBtn) searchNavBtn.style.display = 'block';
            
            // Search Products
            const matchedProducts = products.filter(p => {
                if (!p) return false;
                return (p.name || '').toLowerCase().includes(searchQuery) ||
                       (p.barcode || '').toLowerCase().includes(searchQuery) ||
                       (p.category || '').toLowerCase().includes(searchQuery) ||
                       (p.brand || '').toLowerCase().includes(searchQuery);
            });
            
            // Search Orders
            const matchedOrders = orders.filter(o => {
                if (!o) return false;
                return (o.receiptNo || '').toLowerCase().includes(searchQuery) ||
                       (o.exitCode || '').toLowerCase().includes(searchQuery);
            });
            
            // Search Users
            const matchedUsers = users.filter(u => {
                if (!u) return false;
                return (u.email || '').toLowerCase().includes(searchQuery) ||
                       (u.name || '').toLowerCase().includes(searchQuery);
            });
            
            // Search Feedbacks
            const matchedFeedbacks = feedbacks.filter(f => {
                if (!f) return false;
                return (f.email || '').toLowerCase().includes(searchQuery) ||
                       (f.message || '').toLowerCase().includes(searchQuery);
            });
            
            // Search Bug Reports
            const matchedBugReports = bugReports.filter(b => {
                if (!b) return false;
                return (b.email || '').toLowerCase().includes(searchQuery) ||
                       (b.title || '').toLowerCase().includes(searchQuery) ||
                       (b.description || '').toLowerCase().includes(searchQuery);
            });
            
            const totalResults = matchedProducts.length + matchedOrders.length + matchedUsers.length + matchedFeedbacks.length + matchedBugReports.length;
            
            // Update result count
            const resultCount = document.getElementById('search-result-count');
            if (resultCount) resultCount.textContent = `Found ${totalResults} results for "${query}"`;
            
            // Render results
            renderSearchResults('products', matchedProducts, document.getElementById('search-products'), document.getElementById('search-products-list'), document.getElementById('search-products-count'));
            renderSearchResults('orders', matchedOrders, document.getElementById('search-orders'), document.getElementById('search-orders-list'), document.getElementById('search-orders-count'));
            renderSearchResults('users', matchedUsers, document.getElementById('search-users'), document.getElementById('search-users-list'), document.getElementById('search-users-count'));
            renderSearchResults('feedbacks', matchedFeedbacks, document.getElementById('search-feedbacks'), document.getElementById('search-feedbacks-list'), document.getElementById('search-feedbacks-count'));
            renderSearchResults('bugs', matchedBugReports, document.getElementById('search-bugs'), document.getElementById('search-bugs-list'), document.getElementById('search-bugs-count'));
            
            if (totalResults === 0) {
                if (noResults) noResults.style.display = 'block';
            } else {
                if (noResults) noResults.style.display = 'none';
            }
        }

        function renderSearchResults(type, data, container, list, count) {
            if (!container || !list) return;
            
            if (data.length > 0) {
                container.style.display = 'block';
                if (count) count.textContent = `(${data.length})`;
                
                if (type === 'products') {
                    list.innerHTML = data.map(p => `
                        <tr class="hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4 font-medium text-white">${p.name || 'N/A'}</td>
                            <td class="px-6 py-4 text-slate-400">${p.barcode || 'N/A'}</td>
                            <td class="px-6 py-4 text-slate-400">${p.category || 'N/A'}</td>
                            <td class="px-6 py-4 text-slate-400">₹${((p.price || 0) / 100).toFixed(2)}</td>
                            <td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-semibold ${p.stockQuantity > 0 ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}">${p.stockQuantity || 0}</span></td>
                        </tr>
                    `).join('');
                } else if (type === 'orders') {
                    list.innerHTML = data.map(o => {
                        let dateStr = o.createdAt ? new Date(o.createdAt.seconds * 1000).toLocaleDateString() : 'N/A';
                        return `
                            <tr class="hover:bg-white/5 transition-colors">
                                <td class="px-6 py-4 font-mono text-primary-400">${o.receiptNo || 'N/A'}</td>
                                <td class="px-6 py-4 font-mono text-slate-400">${o.exitCode || 'N/A'}</td>
                                <td class="px-6 py-4 text-slate-400">${dateStr}</td>
                                <td class="px-6 py-4 text-slate-400">${(o.items || []).length}</td>
                                <td class="px-6 py-4 font-semibold text-white">₹${((o.total || 0) / 100).toFixed(2)}</td>
                            </tr>
                        `;
                    }).join('');
                } else if (type === 'users') {
                    list.innerHTML = data.map(u => {
                        const userOrders = Array.isArray(orders) ? orders.filter(o => o.userId === u.id) : [];
                        const totalSpent = (userOrders.reduce((sum, o) => sum + (o.total || 0), 0) / 100).toFixed(2);
                        return `
                            <tr class="hover:bg-white/5 transition-colors">
                                <td class="px-6 py-4 text-slate-400">${u.email || 'N/A'}</td>
                                <td class="px-6 py-4 text-white font-medium">${u.name || 'N/A'}</td>
                                <td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-semibold ${u.role === 'admin' ? 'bg-purple-500/20 text-purple-400' : 'bg-slate-500/20 text-slate-400'}">${u.role || 'user'}</span></td>
                                <td class="px-6 py-4 font-semibold text-white">₹${totalSpent}</td>
                                <td class="px-6 py-4 text-slate-400">${userOrders.length}</td>
                            </tr>
                        `;
                    }).join('');
                } else if (type === 'feedbacks') {
                    list.innerHTML = data.map(f => `
                        <tr class="hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4 text-slate-400">${f.email || 'N/A'}</td>
                            <td class="px-6 py-4">${'⭐'.repeat(f.rating || 0)}<span class="text-slate-500 text-xs ml-2">${f.rating || 0}/5</span></td>
                            <td class="px-6 py-4 text-slate-400">${f.category || 'General'}</td>
                            <td class="px-6 py-4 text-slate-400 max-w-xs truncate">${f.message || 'N/A'}</td>
                        </tr>
                    `).join('');
                } else if (type === 'bugs') {
                    list.innerHTML = data.map(b => `
                        <tr class="hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4 text-slate-400">${b.email || 'N/A'}</td>
                            <td class="px-6 py-4 font-medium text-white">${b.title || 'N/A'}</td>
                            <td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs font-semibold ${b.status === 'resolved' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}">${b.status || 'open'}</span></td>
                            <td class="px-6 py-4 text-slate-400 max-w-xs truncate">${b.description || 'N/A'}</td>
                        </tr>
                    `).join('');
                }
            } else {
                container.style.display = 'none';
            }
        }

        // Notification JS
        async function sendNotificationToAll(e) {
            e.preventDefault();
            const title = document.getElementById('notify-title').value.trim();
            const message = document.getElementById('notify-message').value.trim();
            const statusDiv = document.getElementById('notify-status');
            statusDiv.textContent = 'Sending...';
            try {
                const notifDoc = await db.collection('notifications').add({
                    title,
                    message,
                    timestamp: new Date(),
                });
                const usersSnap = await db.collection('users').get();
                const batch = db.batch();
                usersSnap.forEach(userDoc => {
                    const notifRef = db.collection('users').doc(userDoc.id).collection('notifications').doc(notifDoc.id);
                    batch.set(notifRef, {
                        title: title,
                        message: message,
                        timestamp: new Date(),
                        read: false
                    });
                });
                await batch.commit();
                statusDiv.textContent = 'Notification sent to all users!';
                document.getElementById('notify-form').reset();
                loadNotificationHistory();
            } catch (err) {
                statusDiv.textContent = 'Error: ' + err.message;
            }
        }

        async function loadNotificationHistory() {
            const table = document.getElementById('notification-history-table');
            if (!table) return;
            table.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-slate-500">Loading history...</td></tr>';
            try {
                const snap = await db.collection('notifications').orderBy('timestamp', 'desc').limit(20).get();
                if (snap.empty) {
                    table.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-slate-500">No notifications sent yet.</td></tr>';
                    return;
                }
                table.innerHTML = '';
                snap.forEach(doc => {
                    const data = doc.data();
                    const date = data.timestamp && data.timestamp.toDate ? data.timestamp.toDate() : new Date();
                    table.innerHTML += `
                        <tr>
                            <td class="px-4 py-3 text-white font-semibold">${data.title || ''}</td>
                            <td class="px-4 py-3 text-slate-300 break-words whitespace-pre-line max-w-xs" style="word-break:break-word;">${data.message || ''}</td>
                            <td class="px-4 py-3 text-slate-400">${date.toLocaleString()}</td>
                            <td class="px-4 py-3 text-right">
                                <button onclick="deleteNotificationFromAllUsers('${doc.id}')" class="p-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors hover:scale-110" title="Delete everywhere">
                                    <span class="material-symbols-rounded text-lg">delete</span>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            } catch (err) {
                table.innerHTML = `<tr><td colspan="4" class="px-4 py-8 text-center text-red-400">Error loading history: ${err.message}</td></tr>`;
            }
        }

        async function deleteNotificationFromAllUsers(notifId) {
            if (!confirm('Delete this notification from all users?')) return;
            try {
                await db.collection('notifications').doc(notifId).delete();
                const usersSnap = await db.collection('users').get();
                const batch = db.batch();
                usersSnap.forEach(userDoc => {
                    const notifRef = db.collection('users').doc(userDoc.id).collection('notifications').doc(notifId);
                    batch.delete(notifRef);
                });
                await batch.commit();
                loadNotificationHistory();
            } catch (err) {
                alert('Error deleting notification: ' + err.message);
            }
        }

        // Menu Functions
        let menuOpen = false;

        function toggleMenu() {
            const menu = document.getElementById('slide-menu');
            const overlay = document.getElementById('menu-overlay');

            if (!menu || !overlay) {
                console.error('Menu elements not found!');
                return;
            }

            if (menuOpen) {
                menu.classList.add('transform', '-translate-x-full');
                menu.classList.remove('translate-x-0');
                overlay.classList.add('opacity-0', 'invisible');
                overlay.classList.remove('opacity-100', 'visible');
                document.body.style.overflow = '';
                setTimeout(() => {
                    menu.style.display = 'none';
                    overlay.style.display = 'none';
                }, 300);
            } else {
                menu.style.display = 'block';
                overlay.style.display = 'block';
                menu.offsetHeight; // Force reflow
                menu.classList.remove('transform', '-translate-x-full');
                menu.classList.add('translate-x-0');
                overlay.classList.remove('opacity-0', 'invisible');
                overlay.classList.add('opacity-100', 'visible');
                document.body.style.overflow = 'hidden';
            }
            menuOpen = !menuOpen;
        }

        function selectMenuItem(tabId, iconName, displayName) {
            // Update current tab indicator
            const currentIcon = document.getElementById('current-tab-icon');
            const currentName = document.getElementById('current-tab-name');

            if (currentIcon) currentIcon.textContent = iconName;
            if (currentName) currentName.textContent = displayName;

            showTab(tabId);

            // Close menu on mobile
            if (window.innerWidth < 768 && menuOpen) {
                toggleMenu();
            }
        }

        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && menuOpen) {
                toggleMenu();
            }
        });

        // Init Check
        auth.onAuthStateChanged(async user => {
            const currentUserEmail = user?.email?.toLowerCase?.() || null;
            if (currentUserEmail && ALLOWED_EMAILS_LOWER.includes(currentUserEmail)) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                init();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
            }
        });
        
    </script>
</body>
</html>